from sys import path as sys_path
sys_path.append('../../')
sys_path.append('../../../')
import numpy as np
import hiperwalk as hpw

HPC = 'cpu'
hpw.set_hpc(HPC)

print('test_continuous_cycle')
print(HPC == hpw.get_hpc())


print(HPC == hpw.get_hpc())
N = 101
cycle = hpw.Cycle(N)
ctqw = hpw.ContinuousTime(cycle, gamma=0.35)
psi0 = ctqw.ket(N // 2)
psi_final = ctqw.simulate(range=(N // 2, N // 2 + 1), state=psi0)
prob = ctqw.probability_distribution(psi_final)

expected_state = np.array([[-7.60699517e-06-3.00785537e-06j,
    1.15875478e-06+1.87264165e-05j,
    4.48269711e-05+4.35301685e-07j, -1.59587465e-07-1.04227561e-04j,
   -2.35098480e-04-5.71396368e-08j, 1.99942503e-08+5.13745585e-04j,
    1.08596160e-03+6.84196432e-09j, -2.29100486e-09-2.21667214e-03j,
   -4.36071852e-03-7.51080347e-10j, 2.41208885e-10+8.24905232e-03j,
    1.49656326e-02+7.59215457e-11j, -2.34319311e-11-2.59581080e-02j,
   -4.28838651e-02-7.09443881e-12j, 2.10804860e-12+6.71611420e-02j,
    9.91139780e-02+6.14996056e-13j, -1.76222471e-13-1.36730470e-01j,
   -1.74346962e-01-4.96144048e-14j, 1.37298219e-14+2.02000770e-01j,
    2.06568776e-01+3.73576027e-15j, -9.99747165e-16-1.75724992e-01j,
   -1.04715495e-01-2.63228392e-16j, 6.82080260e-17+3.78728581e-03j,
   -9.84394217e-02+1.73989149e-17j, -4.37030488e-18+1.61290361e-01j,
    1.50408563e-01-1.08123141e-18j, 2.63544014e-19-6.21737904e-02j,
    6.15888626e-02+6.33025932e-20j, -1.49873964e-20-1.46638516e-01j,
   -1.31136044e-01-3.49837366e-21j, 8.05261818e-22+1.82182254e-02j,
   -1.09274174e-01+1.82823225e-22j, -4.09485370e-23+1.43102996e-01j,
    4.60947927e-02-9.04992019e-24j, 1.97394158e-24+9.56912088e-02j,
    1.39051967e-01+4.24999384e-25j, -9.03411434e-26-3.14420181e-02j,
    1.12101666e-01-1.89628068e-26j, 3.93109608e-27-1.21123351e-01j,
    2.21243195e-02+8.04990606e-28j, -1.62856151e-28-1.36294313e-01j,
   -6.35463913e-02-3.25553114e-29j, 6.43146860e-30-9.99820890e-02j,
   -1.14965751e-01+1.25583783e-30j, -2.42412416e-31-4.74263170e-02j,
   -1.33936278e-01-4.62631504e-32j, 8.73040033e-33-1.50530730e-03j,
   -1.34366366e-01+1.62933457e-33j, -3.00749620e-34+2.92070049e-02j,
   -1.29359451e-01-5.49731191e-35j, 9.60735077e-36+4.39909422e-02j,
   -1.26845683e-01+3.54667495e-36j, 9.60735077e-36+4.39909422e-02j,
   -1.29359451e-01-5.49731191e-35j, -3.00749620e-34+2.92070049e-02j,
   -1.34366366e-01+1.62933457e-33j, 8.73040033e-33-1.50530730e-03j,
   -1.33936278e-01-4.62631504e-32j, -2.42412416e-31-4.74263170e-02j,
   -1.14965751e-01+1.25583783e-30j, 6.43146860e-30-9.99820890e-02j,
   -6.35463913e-02-3.25553114e-29j, -1.62856151e-28-1.36294313e-01j,
    2.21243195e-02+8.04990606e-28j, 3.93109608e-27-1.21123351e-01j,
    1.12101666e-01-1.89628068e-26j, -9.03411434e-26-3.14420181e-02j,
    1.39051967e-01+4.24999384e-25j, 1.97394158e-24+9.56912088e-02j,
    4.60947927e-02-9.04992019e-24j, -4.09485370e-23+1.43102996e-01j,
   -1.09274174e-01+1.82823225e-22j, 8.05261818e-22+1.82182254e-02j,
   -1.31136044e-01-3.49837366e-21j, -1.49873964e-20-1.46638516e-01j,
    6.15888626e-02+6.33025932e-20j, 2.63544014e-19-6.21737904e-02j,
    1.50408563e-01-1.08123141e-18j, -4.37030488e-18+1.61290361e-01j,
   -9.84394217e-02+1.73989149e-17j, 6.82080260e-17+3.78728581e-03j,
   -1.04715495e-01-2.63228392e-16j, -9.99747165e-16-1.75724992e-01j,
    2.06568776e-01+3.73576027e-15j, 1.37298219e-14+2.02000770e-01j,
   -1.74346962e-01-4.96144048e-14j, -1.76222471e-13-1.36730470e-01j,
    9.91139780e-02+6.14996056e-13j, 2.10804860e-12+6.71611420e-02j,
   -4.28838651e-02-7.09443881e-12j, -2.34319311e-11-2.59581080e-02j,
    1.49656326e-02+7.59215457e-11j, 2.41208885e-10+8.24905232e-03j,
   -4.36071852e-03-7.51080347e-10j, -2.29100486e-09-2.21667214e-03j,
    1.08596160e-03+6.84196432e-09j, 1.99942503e-08+5.13745585e-04j,
   -2.35098480e-04-5.71396368e-08j, -1.59587465e-07-1.04227561e-04j,
    4.48269711e-05+4.35301685e-07j, 1.15875478e-06+1.87264165e-05j,
   -7.60699517e-06-3.00785537e-06j]])

print(np.allclose(psi_final, expected_state))

expected_prob = np.array(
    [[6.69135695e-11, 3.52021389e-10, 2.00964683e-09, 1.08634100e-08,
      5.52712984e-08, 2.63934526e-07, 1.17931259e-06, 4.91363538e-06,
      1.90158660e-05, 6.80468641e-05, 2.23970160e-04, 6.73823368e-04,
      1.83902589e-03, 4.51061899e-03, 9.82358063e-03, 1.86952214e-02,
      3.03968630e-02, 4.08043111e-02, 4.26706592e-02, 3.08792728e-02,
      1.09653350e-02, 1.43435338e-05, 9.69031974e-03, 2.60145804e-02,
      2.26227359e-02, 3.86558021e-03, 3.79318799e-03, 2.15028544e-02,
      1.71966621e-02, 3.31903736e-04, 1.19408451e-02, 2.04784674e-02,
      2.12472992e-03, 9.15680745e-03, 1.93354495e-02, 9.88600505e-04,
      1.25667835e-02, 1.46708661e-02, 4.89485512e-04, 1.85761397e-02,
      4.03814385e-03, 9.99641813e-03, 1.32171240e-02, 2.24925554e-03,
      1.79389266e-02, 2.26595005e-06, 1.80543203e-02, 8.53049137e-04,
      1.67338675e-02, 1.93520299e-03, 1.60898272e-02, 1.93520299e-03,
      1.67338675e-02, 8.53049137e-04, 1.80543203e-02, 2.26595005e-06,
      1.79389266e-02, 2.24925554e-03, 1.32171240e-02, 9.99641813e-03,
      4.03814385e-03, 1.85761397e-02, 4.89485512e-04, 1.46708661e-02,
      1.25667835e-02, 9.88600505e-04, 1.93354495e-02, 9.15680745e-03,
      2.12472992e-03, 2.04784674e-02, 1.19408451e-02, 3.31903736e-04,
      1.71966621e-02, 2.15028544e-02, 3.79318799e-03, 3.86558021e-03,
      2.26227359e-02, 2.60145804e-02, 9.69031974e-03, 1.43435338e-05,
      1.09653350e-02, 3.08792728e-02, 4.26706592e-02, 4.08043111e-02,
      3.03968630e-02, 1.86952214e-02, 9.82358063e-03, 4.51061899e-03,
      1.83902589e-03, 6.73823368e-04, 2.23970160e-04, 6.80468641e-05,
      1.90158660e-05, 4.91363538e-06, 1.17931259e-06, 2.63934526e-07,
      5.52712984e-08, 1.08634100e-08, 2.00964683e-09, 3.52021389e-10,
      6.69135695e-11]]
) 

print(np.allclose(prob, expected_prob))
