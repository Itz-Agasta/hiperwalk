from sys import path as sys_path
sys_path.append('../../')
sys_path.append('../../../')
import numpy as np
import hiperwalk as hpw

HPC = 'cpu'
hpw.set_hpc(HPC)

print('test_coined_hypercube')
print(HPC == hpw.get_hpc())
print(HPC == hpw.get_hpc())
dim = 6
g = hpw.Hypercube(dim)
qw = hpw.Coined(g)
state = qw.state([[1, i] for i in range(dim)])
states = qw.simulate(range=(dim, dim + 1), state=state)
probs = qw.probability_distribution(states)

expected_prob = np.array(
    [[6.77403512e-05, 0.00000000e+00, 0.00000000e+00, 1.13860240e-02,
      0.00000000e+00, 1.13860240e-02, 1.13860240e-02, 0.00000000e+00,
      0.00000000e+00, 1.13860240e-02, 1.13860240e-02, 0.00000000e+00,
      1.13860240e-02, 0.00000000e+00, 0.00000000e+00, 3.90184423e-02,
      0.00000000e+00, 1.13860240e-02, 1.13860240e-02, 0.00000000e+00,
      1.13860240e-02, 0.00000000e+00, 0.00000000e+00, 3.90184423e-02,
      1.13860240e-02, 0.00000000e+00, 0.00000000e+00, 3.90184423e-02,
      0.00000000e+00, 3.90184423e-02, 3.90184423e-02, 0.00000000e+00,
      0.00000000e+00, 1.13860240e-02, 1.13860240e-02, 0.00000000e+00,
      1.13860240e-02, 0.00000000e+00, 0.00000000e+00, 3.90184423e-02,
      1.13860240e-02, 0.00000000e+00, 0.00000000e+00, 3.90184423e-02,
      0.00000000e+00, 3.90184423e-02, 3.90184423e-02, 0.00000000e+00,
      1.13860240e-02, 0.00000000e+00, 0.00000000e+00, 3.90184423e-02,
      0.00000000e+00, 3.90184423e-02, 3.90184423e-02, 0.00000000e+00,
      0.00000000e+00, 3.90184423e-02, 3.90184423e-02, 0.00000000e+00,
      3.90184423e-02, 0.00000000e+00, 0.00000000e+00, 2.43865264e-01]]
)

print(np.allclose(probs, expected_prob))
